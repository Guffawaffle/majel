<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ariadne â€” STFC Fleet Intelligence</title>

  <!-- Foundation CSS (always loaded) -->
  <link rel="stylesheet" href="styles/variables.css" />
  <link rel="stylesheet" href="styles/base.css" />
  <link rel="stylesheet" href="styles/layout.css" />

  <!-- View CSS (eagerly loaded + tracked by router.js ensureCSS to prevent duplicates) -->
  <link rel="stylesheet" href="views/chat/chat.css" />
  <link rel="stylesheet" href="views/diagnostics/diagnostics.css" />
  <link rel="stylesheet" href="views/catalog/catalog.css" />
  <link rel="stylesheet" href="views/fleet/fleet.css" />
  <link rel="stylesheet" href="views/drydock/drydock.css" />
  <link rel="stylesheet" href="views/crew-builder/crew-builder.css" />
  <link rel="stylesheet" href="views/fleet-ops/fleet-ops.css" />
  <link rel="stylesheet" href="views/crews/crews.css" />
  <link rel="stylesheet" href="views/plan/plan.css" />
  <link rel="stylesheet" href="views/admiral/admiral.css" />

  <!-- Component CSS -->
  <link rel="stylesheet" href="components/confirm-dialog.css" />
  <link rel="stylesheet" href="components/help-panel.css" />

  <!-- Responsive (last â€” overrides at breakpoints) -->
  <link rel="stylesheet" href="styles/responsive.css" />

  <!-- Ariadne favicon pack -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/ariadne-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/ariadne-16x16.png" sizes="16x16">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#14161e">

  <!-- Import map â€” flat module paths, no ../../ counting (ADR-023) -->
  <!-- Phase 1: bare-specifier aliases used after module split (ADR-023) -->
  <!-- CSP hash: update script-src in index.ts if this block changes -->
  <script type="importmap">
  {
    "imports": {
      "api/":        "./api/",
      "views/":      "./views/",
      "components/": "./components/",
      "utils/":      "./utils/",
      "router":      "./router.js",
      "app":         "./app.js"
    }
  }
  </script>
</head>
<body>
  <div id="app">
    <!-- â”€â”€ Sidebar â”€â”€ -->
    <nav id="sidebar">
      <div class="sidebar-logo">âŸ ARIADNE</div>

      <button class="sidebar-nav-btn active" data-view="chat">
        <span class="icon">ğŸ’¬</span> Chat
      </button>
      <button class="sidebar-nav-btn" data-view="catalog">
        <span class="icon">ğŸ“‹</span> Catalog
      </button>
      <button class="sidebar-nav-btn" data-view="fleet">
        <span class="icon">ğŸš€</span> Fleet
      </button>
      <button class="sidebar-nav-btn" data-view="drydock">
        <span class="icon">âš“</span> Drydock
      </button>
      <button class="sidebar-nav-btn" data-view="crew-builder">
        <span class="icon">ğŸ‘¥</span> Crew Builder
      </button>
      <button class="sidebar-nav-btn" data-view="fleet-ops">
        <span class="icon">ğŸ¯</span> Fleet Ops
      </button>
      <button class="sidebar-nav-btn" data-view="crews">
        <span class="icon">âš“</span> Crews
      </button>
      <button class="sidebar-nav-btn" data-view="plan">
        <span class="icon">ğŸ—ºï¸</span> Plan
      </button>
      <button class="sidebar-nav-btn" data-view="diagnostics">
        <span class="icon">âš¡</span> Diagnostics
      </button>
      <button class="sidebar-nav-btn" data-view="admiral">
        <span class="icon">ğŸ›¡ï¸</span> Admiral Console
      </button>

      <div class="sidebar-section-label">Tools</div>
      <button id="new-chat-btn" class="sidebar-nav-btn">
        <span class="icon">âœš</span> New Chat
      </button>
      <button id="history-btn" class="sidebar-nav-btn">
        <span class="icon">ğŸ“œ</span> Lex Memory
      </button>
      <button id="recall-btn" class="sidebar-nav-btn">
        <span class="icon">ğŸ§ </span> Memory Recall
      </button>

      <div class="sidebar-section-label">Recent Chats</div>
      <div class="sidebar-section session-section">
        <div id="session-list" class="session-list"></div>
      </div>

      <div class="sidebar-spacer"></div>

      <button id="logout-btn" class="sidebar-nav-btn logout-btn">
        <span class="icon">ğŸšª</span> Log Out
      </button>

      <div class="sidebar-footer">
        <div class="sidebar-status" id="status-bar">
          <span id="status-indicator" class="status-dot offline"></span>
          <span id="status-text">Connecting...</span>
        </div>
        <div class="sidebar-meta">
          <button id="ops-level-global" class="ops-sidebar" title="Click to edit Ops Level">
            OPS <span id="ops-level-value">â€”</span>
          </button>

        </div>
      </div>
    </nav>

    <!-- â”€â”€ Main Content â”€â”€ -->
    <div id="main">
      <!-- Mobile header -->
      <header id="mobile-header">
        <button id="sidebar-toggle" aria-label="Toggle menu">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M3 5h14M3 10h14M3 15h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        </button>
        <span class="mobile-title">Aria</span>
        <div class="mobile-status">
          <span id="mobile-status-dot" class="status-dot offline"></span>
        </div>
      </header>

      <!-- Dynamic Title Bar -->
      <div id="title-bar" class="title-bar hidden">
        <button id="title-back-btn" class="title-back-btn hidden" aria-label="Back" title="Back">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M11 4L6 9l5 5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <h1 id="title-bar-heading">ğŸ’¬ Chat</h1>
        <span id="title-bar-subtitle" class="subtitle"></span>
        <button id="help-btn" class="help-btn" aria-label="Help" title="Help for this view">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
            <circle cx="9" cy="9" r="7.5" stroke="currentColor" stroke-width="1.3"/>
            <path d="M7 7a2 2 0 1 1 2.5 1.94c-.3.12-.5.4-.5.73V11" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="9" cy="13" r="0.7" fill="currentColor"/>
          </svg>
        </button>
      </div>

      <!-- Setup Guide (shown when not configured) -->
      <div id="setup-guide" class="hidden">
        <div class="setup-container">
          <h2>âš™ï¸ Setup Required</h2>
          <p>Aria needs a couple things configured before she can help you, Admiral.</p>

          <div class="setup-section" id="setup-gemini">
            <h3>1. Gemini API Key <span class="required-badge">Required</span></h3>
            <p>This is the AI engine. Takes about 60 seconds:</p>
            <ol>
              <li>Go to <a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener">Google AI Studio â†’ API Keys</a></li>
              <li>Click <strong>"Create API key"</strong> (free tier works fine)</li>
              <li>Copy the key</li>
              <li>Open <code>/srv/majel/.env</code> in your editor and paste it:</li>
            </ol>
            <pre>GEMINI_API_KEY=AIzaSy...your-key-here</pre>
            <p class="hint">ğŸ’¡ No Google Cloud project needed â€” AI Studio generates the key directly.</p>
          </div>

          <div class="setup-section" id="setup-restart">
            <h3>3. Restart &amp; Go</h3>
            <p>After editing <code>.env</code>, restart the server:</p>
            <pre>npm run dev</pre>
            <p class="hint">This page will auto-detect when setup is complete.</p>
          </div>
        </div>
      </div>

      <!-- Chat Area -->
      <main id="chat-area">
        <!-- Welcome screen -->
        <div id="welcome" class="welcome-screen">
          <div class="welcome-icon">ğŸ––</div>
          <h2>Aria</h2>
          <p class="welcome-sub">STFC Fleet Intelligence System</p>
          <div class="welcome-suggestions">
            <button class="suggestion" data-msg="What crew should I use for the Enterprise?">What crew for the Enterprise?</button>
            <button class="suggestion" data-msg="Show me my strongest officers">My strongest officers</button>
            <button class="suggestion" data-msg="What's the current PvP meta?">Current PvP meta?</button>
            <button class="suggestion" data-msg="Help me plan a mining strategy">Mining strategy</button>
          </div>
        </div>

        <!-- Messages -->
        <div id="messages"></div>

        <!-- Scroll anchor -->
        <button id="scroll-bottom" class="scroll-bottom hidden" aria-label="Scroll to bottom">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 3v10M4 9l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </main>

      <!-- Input -->
      <footer id="input-area">
        <form id="chat-form">
          <div class="input-container">
            <textarea
              id="chat-input"
              placeholder="Message Aria..."
              autocomplete="off"
              rows="1"
            ></textarea>
            <button type="submit" id="send-btn" disabled aria-label="Send message">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M3 15l12-6L3 3v5l8 1-8 1z" fill="currentColor"/></svg>
            </button>
          </div>
          <p class="input-hint">
            <button type="button" id="model-selector-btn" class="model-selector-btn" title="Switch model (Admiral)">
              <span id="model-selector-label">Gemini 2.5 Flash-Lite</span>
              <svg class="model-chevron" width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M2 4l3 3 3-3" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            Â· <kbd>Enter</kbd> send Â· <kbd>Shift+Enter</kbd> newline
          </p>
          <!-- Model picker dropdown -->
          <div id="model-picker" class="model-picker hidden">
            <div class="model-picker-header">Select Model</div>
            <div id="model-picker-list" class="model-picker-list"></div>
          </div>
        </form>
      </footer>

      <!-- Catalog Area (hidden by default) -->
      <section id="catalog-area" class="catalog-area hidden"></section>

      <!-- Fleet Area (hidden by default) -->
      <section id="fleet-area" class="fleet-area hidden"></section>

      <!-- Drydock Area (hidden by default) -->
      <section id="drydock-area" class="drydock-area hidden"></section>

      <!-- Crew Builder Area (hidden by default) -->
      <section id="crew-builder-area" class="crew-builder-area hidden"></section>

      <!-- Fleet Ops Area (hidden by default) -->
      <section id="fleet-ops-area" class="fleet-ops-area hidden"></section>

      <!-- Crews Area (hidden by default) -->
      <section id="crews-area" class="crews-area hidden"></section>

      <!-- Plan Area (hidden by default) -->
      <section id="plan-area" class="plan-area hidden"></section>

      <!-- Diagnostics Area (hidden by default) -->
      <section id="diagnostics-area" class="diagnostics-area hidden"></section>

      <!-- Admin Area (hidden by default) -->
      <section id="admiral-area" class="admiral-area hidden"></section>
    </div>

    <!-- Recall Dialog -->
    <dialog id="recall-dialog">
      <div class="dialog-header">
        <h3>ğŸ” Memory Recall</h3>
        <button class="dialog-close" id="recall-close" aria-label="Close">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        </button>
      </div>
      <form id="recall-form" method="dialog">
        <input type="text" id="recall-input" placeholder="Search past conversations..." autocomplete="off" />
        <button type="submit">Search</button>
      </form>
      <div id="recall-results"></div>
    </dialog>

    <!-- Sidebar overlay (mobile) -->
    <div id="sidebar-overlay" class="hidden"></div>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
