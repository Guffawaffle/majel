<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ariadne â€” STFC Fleet Intelligence</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="app">
    <!-- â”€â”€ Sidebar â”€â”€ -->
    <nav id="sidebar">
      <div class="sidebar-logo">âŸ ARIADNE</div>

      <button class="sidebar-nav-btn active" data-view="chat">
        <span class="icon">ğŸ’¬</span> Chat
      </button>
      <button class="sidebar-nav-btn" data-view="drydock">
        <span class="icon">ğŸ”§</span> Drydock
      </button>
      <button class="sidebar-nav-btn" data-view="fleet">
        <span class="icon">ğŸš€</span> Fleet
      </button>
      <button class="sidebar-nav-btn" data-view="catalog">
        <span class="icon">ğŸ“‹</span> Catalog
      </button>

      <div class="sidebar-section-label">Tools</div>
      <button id="new-chat-btn" class="sidebar-nav-btn">
        <span class="icon">âœš</span> New Chat
      </button>
      <button id="history-btn" class="sidebar-nav-btn">
        <span class="icon">ğŸ“œ</span> Lex Memory
      </button>
      <button id="recall-btn" class="sidebar-nav-btn">
        <span class="icon">ğŸ§ </span> Memory Recall
      </button>
      <button id="diagnostic-btn" class="sidebar-nav-btn">
        <span class="icon">âš¡</span> Diagnostic
      </button>

      <div class="sidebar-section-label">Recent Chats</div>
      <div class="sidebar-section session-section">
        <div id="session-list" class="session-list"></div>
      </div>

      <div class="sidebar-spacer"></div>

      <div class="sidebar-footer">
        <div class="sidebar-status" id="status-bar">
          <span id="status-indicator" class="status-dot offline"></span>
          <span id="status-text">Connecting...</span>
        </div>
        <div class="sidebar-meta">
          <button id="ops-level-global" class="ops-sidebar" title="Click to edit Ops Level">
            OPS <span id="ops-level-value">â€”</span>
          </button>

        </div>
      </div>
    </nav>

    <!-- â”€â”€ Main Content â”€â”€ -->
    <div id="main">
      <!-- Mobile header -->
      <header id="mobile-header">
        <button id="sidebar-toggle" aria-label="Toggle menu">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M3 5h14M3 10h14M3 15h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        </button>
        <span class="mobile-title">Aria</span>
        <div class="mobile-status">
          <span id="mobile-status-dot" class="status-dot offline"></span>
        </div>
      </header>

      <!-- Dynamic Title Bar -->
      <div id="title-bar" class="title-bar hidden">
        <h1 id="title-bar-heading">ğŸ’¬ Chat</h1>
        <span id="title-bar-subtitle" class="subtitle"></span>
      </div>

      <!-- Setup Guide (shown when not configured) -->
      <div id="setup-guide" class="hidden">
        <div class="setup-container">
          <h2>âš™ï¸ Setup Required</h2>
          <p>Aria needs a couple things configured before she can help you, Admiral.</p>

          <div class="setup-section" id="setup-gemini">
            <h3>1. Gemini API Key <span class="required-badge">Required</span></h3>
            <p>This is the AI engine. Takes about 60 seconds:</p>
            <ol>
              <li>Go to <a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener">Google AI Studio â†’ API Keys</a></li>
              <li>Click <strong>"Create API key"</strong> (free tier works fine)</li>
              <li>Copy the key</li>
              <li>Open <code>/srv/majel/.env</code> in your editor and paste it:</li>
            </ol>
            <pre>GEMINI_API_KEY=AIzaSy...your-key-here</pre>
            <p class="hint">ğŸ’¡ No Google Cloud project needed â€” AI Studio generates the key directly.</p>
          </div>

          <div class="setup-section" id="setup-restart">
            <h3>3. Restart &amp; Go</h3>
            <p>After editing <code>.env</code>, restart the server:</p>
            <pre>npm run dev</pre>
            <p class="hint">This page will auto-detect when setup is complete.</p>
          </div>
        </div>
      </div>

      <!-- Chat Area -->
      <main id="chat-area">
        <!-- Welcome screen -->
        <div id="welcome" class="welcome-screen">
          <div class="welcome-icon">ğŸ––</div>
          <h2>Aria</h2>
          <p class="welcome-sub">STFC Fleet Intelligence System</p>
          <p class="welcome-credit">Named in honor of Majel Barrett-Roddenberry</p>
          <div class="welcome-suggestions">
            <button class="suggestion" data-msg="What crew should I use for the Enterprise?">What crew for the Enterprise?</button>
            <button class="suggestion" data-msg="Show me my strongest officers">My strongest officers</button>
            <button class="suggestion" data-msg="What's the current PvP meta?">Current PvP meta?</button>
            <button class="suggestion" data-msg="Help me plan a mining strategy">Mining strategy</button>
          </div>
        </div>

        <!-- Messages -->
        <div id="messages"></div>

        <!-- Scroll anchor -->
        <button id="scroll-bottom" class="scroll-bottom hidden" aria-label="Scroll to bottom">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 3v10M4 9l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </main>

      <!-- Input -->
      <footer id="input-area">
        <form id="chat-form">
          <div class="input-container">
            <textarea
              id="chat-input"
              placeholder="Message Aria..."
              autocomplete="off"
              rows="1"
            ></textarea>
            <button type="submit" id="send-btn" disabled aria-label="Send message">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M3 15l12-6L3 3v5l8 1-8 1z" fill="currentColor"/></svg>
            </button>
          </div>
          <p class="input-hint">Gemini 2.5 Flash-Lite Â· <kbd>Enter</kbd> send Â· <kbd>Shift+Enter</kbd> newline</p>
        </form>
      </footer>

      <!-- Drydock Area (hidden by default) -->
      <section id="drydock-area" class="drydock-area hidden"></section>

      <!-- Fleet Manager Area (hidden by default) -->
      <section id="fleet-manager-area" class="fleet-manager-area hidden"></section>

      <!-- Catalog Area (hidden by default) -->
      <section id="catalog-area" class="catalog-area hidden"></section>
    </div>

    <!-- Recall Dialog -->
    <dialog id="recall-dialog">
      <div class="dialog-header">
        <h3>ğŸ” Memory Recall</h3>
        <button class="dialog-close" id="recall-close" aria-label="Close">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        </button>
      </div>
      <form id="recall-form" method="dialog">
        <input type="text" id="recall-input" placeholder="Search past conversations..." autocomplete="off" />
        <button type="submit">Search</button>
      </form>
      <div id="recall-results"></div>
    </dialog>

    <!-- Diagnostic Dialog -->
    <dialog id="diagnostic-dialog">
      <div class="dialog-header">
        <h3>ğŸ“Š System Diagnostic</h3>
        <button class="dialog-close" id="diagnostic-close" aria-label="Close">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        </button>
      </div>
      <div id="diagnostic-content" class="diagnostic-content">
        <p class="diagnostic-loading">Querying subsystems...</p>
      </div>
    </dialog>

    <!-- Sidebar overlay (mobile) -->
    <div id="sidebar-overlay" class="hidden"></div>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
